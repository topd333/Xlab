{% extends "base-join.html" %}

{% load i18n %}
{% load crispy_forms_tags %}
{% block navigation %}
    {% include "partials/nav_primary.html" with expand_dropdown=1 %}
{% endblock %}

{% block header %}{% endblock %}

{% block column_left %}
{% endblock %}

{% block content %}

<div class="header">
    <div class="container">
      <div class="header-inner">
        <div class="logo">
          <a href="javascript:void(0)">
            <img src="{{ STATIC_URL }}images/logo.png" alt="logo">
          </a>
        </div>
        <div class="language">
          <ul class="language-select">
            <li><a href="javascript:void(0)"> Language  <i class="fa fa-angle-double-down"> </i> </a> 
              <ul class="no-display">
                <li> <a href="javascript:void(0)">English</a>
                </li>
                <li> <a href="javascript:void(0)">日本語</a>
                </li>
                <li> <a href="javascript:void(0)">Deutsch</a>
                </li>
                <li> <a href="javascript:void(0)">Français</a>
                </li>
                <li> <a href="javascript:void(0)">Español</a>
                </li>
                <li> <a href="javascript:void(0)">Português</a>
                </li>
                <li> <a href="javascript:void(0)">Italiano</a>
                </li>
                <li> <a href="javascript:void(0)">Türkçe</a>
                </li>
                <li> <a href="javascript:void(0)">русская</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
      <div id="fb-logout-div">
        <a class="fb-logged-text" id="fb-name" data-message="You are logged in as [user_name]"></a>
        <img id="fb-logo" src="img/facebook_logo_small.png" />
        <a class="fb-logged-text" data-social="" id="fb-logout">Log out</a>
      </div>
    </div>
  </div> 
<div class="section">

    <div class="bottom-bg">
      <div class="container">





        <div class="inner-wizard">
          <div id="wizard">
            <h2>First Step</h2>
            <section>
              <div class="tab-section">
                <div class="top-page">
                  <div class="top-page-main"><a class="current" id="people" href="javascript:void(0)">People</a>
                  </div>
                  <div class="top-page-main"><a id="vampires" href="javascript:void(0)">Vampires</a>
                  </div>
                  <div class="top-page-main"><a id="classic" href="javascript:void(0)">Classic</a>
                  </div>
                </div>

                <div class="tab-content">
                  <div class="category">
                    <div class="wrap">
                      <div id="showcase" class="noselect">
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic1.png" alt="people-pic1.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic2.png" alt="people-pic2.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic3.png" alt="people-pic3.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic4.png" alt="people-pic4.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic5.png" alt="people-pic5.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic6.png" alt="people-pic6.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic7.png" alt="people-pic7.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic8.png" alt="people-pic8.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic9.png" alt="people-pic9.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic10.png" alt="people-pic10.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic11.png" alt="people-pic11.png">
                        </a>
                        <a href="javascript:void(0)">
                          <img class="cloud9-item" src="{{ STATIC_URL }}images/avtar/people/pic12.png" alt="people-pic12.png">
                        </a>
                      </div>

                      <div class="pic-stage">
                        <img src="{{ STATIC_URL }}images/stage.png" alt="">
                      </div>
                      <!-- <p id="item-title" style="display:none;"></p> -->
                      <input type="hidden" name="item-index" id="item-index" />
                      <input type="hidden" name="item-title" id="item-title" />
                      <div id="nav" class="noselect bottom-btn">
                        <button class="left btn-left">
                          <img src="{{ STATIC_URL }}images/left-slide.png" alt="">
                        </button>
                        <!-- <a href="javascript:void(0)" class="center-btn choose-avatar">
                          <img src="{{ STATIC_URL }}images/choode-avtaar.png" alt="">
                        </a>  -->   
                        <a href="javascript:void(0)" class="center-btn choose-avatar" ><img src="{{ STATIC_URL }}images/choode-avtaar.png" alt=""></a>
                        <button class="right btn-right">
                          <img src="{{ STATIC_URL }}images/right-slide.png" alt="">
                        </button>
                      </div>
                      

                    </div>
                  </div>

                  <!-- <div class="tab-pane" id="profile">Vampires</div>
                  <div class="tab-pane" id="messages">Classic</div> -->
                </div>

              </div>

            </section>

            <h2>Second Step</h2>
            <section>

              <div class="tab-section">
                <div class="page-heading">Create a Username</div>
                <div class="page-detail clearfix">
                  <div class="tool-tip-detail">
                    <a id="" class="detail-tip element" href="javascript:void(0)" data-toggle="popover" data-content="Your username is used to log in. Once you’re inside LinkinULife, you can create a name for your avatar."><i class="fa fa-question-circle"> </i></a> 
                  </div>

                  <div class="page-detail-left">
                    <img src="{{ STATIC_URL }}images/avtar-body.png" alt="">
                  </div>
                  <div class="page-detail-right">
                    <div class="page-txt">You will use your username to login, so don't forget it!</div>

                    <div class="page-field"> <input type="text" name="checkusername" id="checkusername" class="field-txt" autocomplete="off" title="Enter  your name" value="Enter  your name" onFocus="if(this.value=='Enter  your name')this.value='';" onBlur="if(this.value=='')this.value='Enter  your name';"/></div>
                    <div class="name-status-message" id="checking-availability" style="display: none;">
                          <img class="loading-graphic" src="{{ STATIC_URL }}img/loading_icon.gif" alt="Checking availability...">
                          <span class="checking-availability-text">Checking availability...</span>
                    </div>

                    <div class="available-user error-username"></div>

                    <div class="page-field-btn nextstep" style="display: none;">
                      <a href="javascript:void(0)" class="chexk-avail choose-username" > Next Step </a>
                    </div>

                    <div class="page-field-btn check">                      
                      <a href="javascript:void(0)" class="chexk-avail"> Check Availability </a> 
                    </div>

                  </div>
                </div>
                <div class="go-back"><a href="javascript:void(0)"><i class="fa fa-chevron-left"> </i> Go back to change your avatar</a>
                </div>
              </div>
            </section>

            <h2>Third step</h2>
            <section class="fourth-step">
              <div class="tab-section">
                <div class="page-heading">Just a few more questions…</div>
                <div class="page-detail clearfix">
                  <div class="tool-tip-detail">
                    <a id="" class="detail-tip element" href="javascript:void(0)" data-toggle="popover" data-content="We value your privacy. We won’t sell or give away your email. We ask for your birthday because you must be at least 16 to enter LinkinULife. Your security question and answer are used by our support team to verify your identity if you lose your password."><i class="fa fa-question-circle"> </i></a>  
                  </div>

                  <div class="page-detail-left top-padding">
                    <img src="{{ STATIC_URL }}images/avtar-body.png" alt="">
                  </div>
                  <div class="page-detail-right">


                    <form data-parsley-validate method="POST" id="registration-form" >
                    
                    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" />
                    
                    <div class="page-row connect-with">
                      <div class="page-row-left">Connect with</div>
                      <div class="page-row-right">
                        <a class="social-link" href="javascript:void(0)" >
                          <img src="{{ STATIC_URL }}images/fb.png" alt="facebook" id="fb_login_button" >
                        </a>
                        <div class="social-link" id="google-signin">
                          <img src="{{ STATIC_URL }}images/google.png" alt="google" >
                        </div>
                      </div>

                    </div>
                    <div class="page-row">
                      <div ><input class="textinput textInput" data-parsley-required="true" data-parsley-required-message="This field is required." id="id_username" name="username" type="hidden">
                        <input class="textinput textInput" name="avatarname" id="id_avatarname" type="hidden">
                        <p id="err_message" style="color:#B94A48;"></p> </div>
                     <!--  <div class="page-row-left"></div>
                      <div class="page-row-right">
                        
                      </div> -->
                    </div>

                    <div class="page-row">
                      <div class="page-row-left">Email</div>
                      <div class="page-row-right">
                        <input type="text" name="email" class="field-txt-small" data-parsley-maxlength="95" data-parsley-required="true" data-parsley-required-message="This field is required." data-parsley-type="email" data-parsley-type-email-message="Enter a valid email address."   placeholder="Enter your Email address" id="id_email"/>
                      </div>
                    </div>
                    <div class="page-row">
                      <div class="page-row-left">First Name</div>
                      <div class="page-row-right">
                        <input type="text" name="firstname" id="id_firstname" class="field-txt-small" data-parsley-maxlength="32" data-parsley-required="true" data-parsley-required-message="This field is required." id="id_firstname" maxlength="32"   placeholder="Enter your First Name" />
                      </div>
                    </div>

                    <div class="page-row">
                      <div class="page-row-left">Last Name</div>
                      <div class="page-row-right">
                        <input type="text" name="lastname" class="field-txt-small" data-parsley-maxlength="32" data-parsley-required="true" data-parsley-required-message="This field is required." id="id_lastname" maxlength="32"  placeholder="Enter your Last Name" id="id_lastname" />
                      </div>
                    </div>

                    <div class="page-row">
                      <div class="page-row-left">Date of Birth</div>
                      <div class="page-row-right">
                        <!-- <input class="dateinput"  id="id_dob" name="dob" type="text"> -->
                        <input type="text" id="id_dob" name="dob" class="field-txt-small dateinput" data-parsley-required="true" data-parsley-required-message="This field is required." placeholder="Enter your date of birth" data-parsley-pattern="/^(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])\D?(\d{4})$/"/>
                        <a class="date-show" href="javascript:void(0)"><i class="fa fa-calendar "> </i></a>
                      </div>
                    </div>

                    <div class="page-row">
                      <div class="page-row-left">Password</div>
                      <div class="page-row-right">
                        <!-- <input class="textinput textInput"  id="id_password" name="password" type="password"> -->
                        <input type="password" id="id_password" name="password" class="field-txt-small" data-parsley-required="true" data-parsley-minlength="3" data-parsley-required-message="This field is required." placeholder="Enter your Password"/>
                      </div>
                    </div>

                    <div class="page-row">
                      <div class="page-row-left">Security Question</div>
                      <div class="page-row-right">
                        <div class="select-query-box">
                          <select class="field-txt-select" id="id_securtyq" name="securtyq" data-parsley-required="true" data-parsley-required-message="This field is required." >
                            <option value="">Select a Question</option>
                            <option value="1">What city were you born in?</option>
                            <option value="2">What is your mother's maiden name?</option>
                            <option value="3">What street did you grow up on?</option>
                            <option value="4">What is the title of your favorite book?</option>
                            <option value="5">What is your favorite vacation spot?</option>
                            <option value="6">What is your pet's name?</option>
                          </select>
                          <div class="arrow-right-show"></div>
                        </div>
                      </div>
                    </div>


                    <div class="page-row">
                      <div class="page-row-left">Security Answer</div>
                      <div class="page-row-right">
                        <input type="text" name="securtya" id="id_securtya" class="field-txt-small" data-parsley-maxlength="255" data-parsley-required="true" data-parsley-required-message="This field is required." title="Enter your answer" placeholder="Enter your answer" />
                      </div>
                    </div>

                    <div class="row-bottom">
                      By clicking Create Account you are indicating that you have read and agree to the Terms of Service <a href="javascript:void(0)"> Agreement </a> and<a href="javascript:void(0)"> Privacy Policy.</a> You will receive email newsletters, account updates and special offers targeted to your interests, sent to you by LinkinULife. We will not sell, rent or share your address with affiliates or third parties.
                    </div>


                    <div class="name-status-message" id="creating-account" style="display: none;">
                          <img class="loading-graphic" src="{{ STATIC_URL }}img/loading_icon.gif" alt="Checking availability...">
                          <span class="checking-availability-text">Creating Account...</span>
                    </div>
                    <div class="page-field-btn">
                      <input type="button" value="Create Account" id="create-account" class="chexk-avail">
                     <!--  <a href="javascript:void(0)" class="chexk-avail"> Create Account </a> -->
                    </div>
                    </form>
                  </div>
                </div>
                <div class="go-back"><a href="javascript:void(0)"><i class="fa fa-chevron-left"> </i> Go back to change your avatar</a>
                </div>
              </div>
            </section>
                        
            <h2>Fourth step</h2>
            <section>
              <div class="tab-section">
                <div class="page-heading">Select an Account</div>
                <div class="page-detail clearfix">

                  <div class="page-detail-left top-padding">
                    <img src="{{ STATIC_URL }}images/avtar-body.png" alt="">
                  </div>
                  <div class="page-detail-right page-detail-right-min">

                    <div class="create-account">
                      <div class="create-account-left">
                        <div class="create-account-left-main">
                          <img src="{{ STATIC_URL }}images/ac1.png" alt="">
                          <h2>Your Own Avatar</h2>
                          <p>Customize and Change it to anything you want</p>
                        </div>

                        <div class="create-account-left-main">
                          <img src="{{ STATIC_URL }}images/ac2.png" alt="">
                          <h2>The LinkinU Life World</h2>
                          <p>Access thousands of fun 3D places and events</p>
                        </div>

                        <div class="create-account-left-main">
                          <img src="{{ STATIC_URL }}images/ac3.png" alt="">
                          <h2>A Home</h2>
                          <p>Your own private 3D home to decorate and entertain in*</p>
                        </div>

                        <div class="create-account-left-main">
                          <img src="{{ STATIC_URL }}images/ac4.png" alt="">
                          <h2>Exclusive Extras</h2>
                          <p>Virtual currency rewards and gifts, access to Premium Sandboxes and more!</p>
                        </div>

                        <div class="create-account-left-main-bottom">
                          <p>*Linkin homes and some adult areas are accessible only to those 18 years and older.</p>
                        </div>

                      </div>

                      <ul class="create-account-right">
                        <li>
                          <h2>FREE</h2>
                          <div class="create-ac-right-row">
                            <i class="fa fa-check"> </i>
                          </div>

                          <div class="create-ac-right-row">
                            <i class="fa fa-check"> </i>
                          </div>

                          <div class="create-ac-right-row">
                            &nbsp;
                          </div>

                          <div class="create-ac-right-row">
                            &nbsp;
                          </div>

                          <div class="create-ac-right-row create-ac-right-row-price">
                            <span class="ac-bottom">Free Account</span>
                            <a href="javascript:void(0)" id="free" class="free-account">
                              <img src="{{ STATIC_URL }}images/select.png" alt="" >
                            </a>
                          </div>

                        </li>

                        <li>
                          <h2>PREMIUM</h2>
                          <div class="create-ac-right-row">
                            <i class="fa fa-check"> </i>
                          </div>

                          <div class="create-ac-right-row">
                            <i class="fa fa-check"> </i>
                          </div>

                          <div class="create-ac-right-row">
                            <i class="fa fa-check"> </i>
                          </div>

                          <div class="create-ac-right-row">
                            <i class="fa fa-check"> </i>
                          </div>

                          <div class="create-ac-right-row create-ac-right-row-price">
                            <span class="ac-bottom">$6/Month</span>
                            <a href="javascript:void(0)" class="premium-account" >
                              <img src="{{ STATIC_URL }}images/select.png" alt="">
                            </a>
                          </div>

                        </li>

                      </ul>



                    </div>

                  </div>
                </div>

              </div>
            </section>

            <h2>Fifth step</h2>
            <section>
              <div class="tab-section">
                <div class="page-heading">Just One Step TO Linkinu Life!</div>
                <div class="page-detail clearfix">

                  <div class="page-detail-left">
                    <img src="{{ STATIC_URL }}images/avtar-body.png" alt="">
                  </div>
                  <div class="page-detail-right">

                    <div class="linkinu-step">
                      <h2>Please Activate Your Account</h2>
                      <p>Before you can Download, you must active your account with the code link sent to your email address.</p>
                      <p>If you did not receive this email, please check your junk/spam folder. Click here to resend the activation email.</p>
                      <p>If you entered an incorrect email address, you will need to re-register with the correct email address.</p>
                      <p>If you have forgotten your password, you can retrieve it from the forgotten password page.</p>


                    </div>


                  </div>
                </div>

              </div>
            </section>
          </div>

        </div>





      </div>
    </div>
</div>

{% endblock content %}

{% block footer %}
  <div class="footer">
  <p>This is how you will initially appear in <a href="javascript:void(0)">Linkinulife.</a> </p>
  <p>You can customize your appearance later.</p></div>
{% endblock footer %}

{% block extrastyles %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/datepicker.css" />
{% endblock %}

{% block extrascripts %}
<script src="{{ STATIC_URL }}js/bootstrap-datepicker.js"></script>
<script src="{{ STATIC_URL }}js/moment.js"></script>

<script type="text/javascript">

    var alphaexp = /^[0-9a-zA-Z]+$/;
    var globeusername = '';
    var chooseavatar = '';
    var currenttab = 'people';
    var chooseavatarindex = '';
    var created_user = {};

    $(function() {

        people = ['pic1.png', 'pic2.png', 'pic3.png', 'pic4.png', 'pic5.png', 'pic6.png', 'pic7.png', 'pic8.png', 'pic9.png', 'pic10.png', 'pic11.png', 'pic12.png']
        vampires = ['pic1.png', 'pic2.png', 'pic3.png', 'pic4.png', 'pic5.png', 'pic6.png', 'pic7.png', 'pic8.png', 'pic9.png', 'pic10.png', 'pic11.png', 'pic12.png']
        classic = ['pic1.png', 'pic2.png', 'pic3.png', 'pic4.png', 'pic5.png', 'pic6.png', 'pic7.png', 'pic8.png', 'pic9.png', 'pic10.png', 'pic11.png', 'pic12.png']
        var count = 400;

        $('#people').click(function(event) {
          currenttab = 'people';

          $('.top-page').find('a').each(function(index, val) {
             $(this).removeClass('current')
          });

          $(this).addClass('current');
          $("#showcase").find('img').each(function(index, value) {
              var a = '<img class="reflected" id="avatar'+index+'" src="/static/images/avtar/'+currenttab+'/'+people[index]+'" alt="'+currenttab+'-'+people[index]+'" style="display: none; border: 0px; width: 100%;" >'
              $( this ).replaceWith( a );

              showimg('avatar'+index);

            });
          count = 400;
          $('#showcase .cloud9-item:first').click();
        });


        $('#vampires').click(function(event) {

          currenttab = 'vampires';

          $('.top-page').find('a').each(function(index, val) {
             $(this).removeClass('current')
          });

          $(this).addClass('current');
          $("#showcase").find('img').each(function(index, value) {
              var a = '<img class="reflected" id="avatar'+index+'" src="/static/images/avtar/'+currenttab+'/'+vampires[index]+'" alt="'+currenttab+'-'+vampires[index]+'" style="display: none; border: 0px; width: 100%;" >'
              $( this ).replaceWith( a );

              showimg('avatar'+index);

          });
          count = 400;
          $('#showcase .cloud9-item:first').click();


        });

        $('#classic').click(function(event) {
          currenttab = 'classic';

          $('.top-page').find('a').each(function(index, val) {
             $(this).removeClass('current')
          });

          $(this).addClass('current');

          $("#showcase").find('img').each(function(index, value) {
              var a = '<img class="reflected" id="avatar'+index+'" src="/static/images/avtar/'+currenttab+'/'+classic[index]+'" alt="'+currenttab+'-'+classic[index]+'" style="display: none; border: 0px; width: 100%;" >'
              $( this ).replaceWith( a );

              showimg('avatar'+index);

            });
          count = 400;
          $('#showcase .cloud9-item:first').click();


        });

        function showimg(ids){
          //$('#'+ids).delay("slow").fadeOut();
          $('#'+ids).delay(""+count+"").fadeIn();
          count = count + 300;
        }

        //$('#registration-form').parsley();

        $form = $('#registration-form');
        
        $('#create-account').click(function(event) {
            var flag = false;
            username = $('#id_username').val();
            $pars = $form.parsley();
            flag = $pars.validate();
            if(flag && (username != "" || username.match(alphaexp) != null)) {
                $('#creating-account').css("display", "block");
                $('#create-account').css("display", "none");
                
                $.ajax({
                    type: "POST",
                    url: '/ajax_register/',
                    data: $form.serialize(),
                }).done(function(msg) {
                    console.log(msg)

                    if(msg.status) {

                        $.each(msg, function(key, value) {
                            created_user[key] = value;
                        });
                        $form[0].reset();
                        $('#creating-account').css("display", "none");
                        $('#create-account').css("display", "block");
                        $('.actions a:eq(1)').click();
                    } else {

                        if(msg.hasOwnProperty("error")) {
                            $('#create-account').css("display", "block");
                            $('#creating-account').css("display", "none");
                            $.each(msg.error, function(key, value) {
                                $('#id_' + key).next().empty();
                                $('#id_' + key).next().append('<li> ' + value + '</li>');
                            });
                        }
                        if(msg.hasOwnProperty("err_message")) {
                            $('#create-account').css("display", "block");
                            $('#creating-account').css("display", "none");
                            $('#err_message').text(msg.err_message);
                        }
                        else{
                          $('#err_message').text('');
                        }
                    }

                });

            }
        });
      

      $("#free").click(function(event) {
        /* Act on the event */
      $.ajax({
        url: '{% url "accounttype_registration" %}',
        type: "POST",
        data: {
          csrfmiddlewaretoken: '{{ csrf_token }}',
          user_id: created_user['id']

        },
       })
      });

        $('.choose-avatar, .choose-username, .free-account, .premium-account').click(function() {
            $('.actions a:eq(1)').click();
            //$('#example-advanced-form-t-1').click();
        });

        $('.choose-avatar').click(function(event) {
          text = $('#item-title').val();
          index = $('#item-index').val();
          chooseavatar = text.split('-')[1];
          //currenttab = text.split('-')[0]
          chooseavatarindex = Math.abs(index)



          $(".page-detail-left img").each(function() {
                $(this).attr("src", "/static/images/avtar/" + currenttab +"/"+ chooseavatar + "");
            });
          //$('#id_avatarname').val(currenttab+'-'+chooseavatar);

          $('#id_avatarname').val($('#avatar'+chooseavatarindex).attr('alt'))
        });


        $('.go-back').click(function(event) {
            $('.actions a:eq(0)').click();
        });

        $('.check').click(function() {

            var username = $('#checkusername').val();
            var flag = false;

            if(username == "" || username.match(alphaexp) == null) {
                flag = false;
                $('.error-username').html("Names must be at least 2 characters in length.")
            } else {
                flag = true;
            }

            $('#checkusername').focus(function(event) {
                $('.error-username').html("")
                $('.check').css("display", "block");
                $('.nextstep').css("display", "none");
            });

            data = {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                username: username
            }
            if(flag) {
                $('#checking-availability').css("display", "block");
                $.ajax({
                    type: "POST",
                    url: '/account/ajax/ajax_checkusername',
                    data: data,
                }).done(function(msg) {
                    $('#checking-availability').css("display", "none");
                    if(msg.available) {
                        $('.error-username').html("It's available");
                        $('.check').css("display", "none");
                        $('.nextstep').css("display", "block");
                    } else {
                        globeusername = '';
                        $('.error-username').html("That name is taken.  Try again.")
                    }

                });

            }
            $('.nextstep').click(function(event) {
                $('#id_username').val(username);
                globeusername = username;
            });

        });

        $('.dateinput').datepicker();


    });
$(document).ready(function() {  
  $("#registration-form").find("ul").hide();
    // instanciate parsley and set the container as the element title without a wrapper
    $("#registration-form").parsley({
       errorsContainer: function (ParsleyField) {
        return ParsleyField.$element.attr("title");
       },
       errorsWrapper: false
    });
    
    // when there is an error, display the tooltip with the error message
    $.listen('parsley:field:error', function(fieldInstance) {
      var messages = ParsleyUI.getErrorsMessages(fieldInstance);
            console.log(fieldInstance)
            
            fieldInstance.$element.tooltip('destroy');
      fieldInstance.$element.tooltip({
        animation: false,
        container: 'body',
        placement: 'right',
        title: messages
      });
    });
    // destroy tooltip when field is valid
    $.listen('parsley:field:success', function(fieldInstance) {     
        fieldInstance.$element.tooltip('destroy');
    });
  });
  
</script>




<script type="text/javascript">

      window.fbAsyncInit = function() {
        FB.init({
          appId      : '354145661417421',
          xfbml      : true,
          version    : 'v2.1'
        });
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));

    $(function() {
        $('#fb-logout-div').hide('fast', function() {});
        $('#fb_login_button').click(function(event) {
            FB.login(function(response) {
                console.log(response);
                if(response && response.status === 'connected') {
                    $('#fb-logout').attr('data-social', 'facebook');
                    FB.api('/me', function(response) {
                        fillvalue(response);
                        $('.connect-with').hide('fast', function() {});
                        $('#fb-logout-div').show('fast', function() {});
                        var facebook_message = $('#fb-name').data('message');
                        $('#fb-name').text(facebook_message.replace("[user_name]", response.name));
                    });
                }
            }, {
                scope: 'public_profile,email,user_birthday',
            });


        });


        function fillvalue(data) {
            var date = new Date(data.birthday);
            var date_str = moment(date).format("MM/DD/YYYY");
            $('#registration-form #id_firstname').val(data.first_name);
            $('#registration-form #id_lastname').val(data.last_name);
            $('#registration-form #id_dob').val(date_str);
            $('#registration-form #id_email').val(data.email);
        }


    });


    function fbLogout() {
        FB.getLoginStatus(function(response) {
            if(response && response.status === 'connected') {
                //Signoutplus();
                FB.logout(function(response) {
                    $('#fb-logout').attr('data-social', '');
                    $('.connect-with').show('fast', function() {});
                    $('#registration-form #id_firstname').val('');
                    $('#registration-form #id_lastname').val('');
                    $('#registration-form #id_dob').val('');
                    $('#registration-form #id_email').val('');
                });
            }
        });
    }
</script>

<script type="text/javascript">
    (function() {
        var po = document.createElement('script');
        po.type = 'text/javascript';
        po.async = true;
        po.src = 'https://apis.google.com/js/client:plusone.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(po, s);
    })();

    $(document).ready(function($) {
        $('#google-signin').click(function(event) {
            gapi.auth.signIn({
                'clientid': '341928341567-h5j1urj9btplo5a4eachiinktvkm8omj.apps.googleusercontent.com',
                'cookiepolicy': 'single_host_origin',
                'callback': 'signinCallback',
                'requestvisibleactions': 'http://schema.org/AddAction',
                'data-scope': 'https://www.googleapis.com/auth/plus.login'
            });

        });
    });


    function signinCallback(authResult) {
        if(authResult['status']['signed_in']) {
            $('.connect-with').hide('fast', function() {});
            $('#fb-logout-div').show('fast', function() {});
            $('#fb-logout').attr('data-social', 'googleplus');
            gapi.client.load('plus', 'v1', function() {
                var request = gapi.client.plus.people.get({
                    'userId': 'me'
                });

                request.execute(function(resp) {
                  console.log(resp)
                    var facebook_message = $('#fb-name').data('message');
                    $('#fb-name').text(facebook_message.replace("[user_name]", resp.displayName));
                    $('#registration-form #id_firstname').val(resp.name.givenName);
                    $('#registration-form #id_lastname').val(resp.name.familyName);
                    $('#registration-form #id_dob').val(resp.birthday);
                    $('#registration-form #id_email').val(resp.emails[0].value);

                });
            });


        } else {
            console.log('Sign-in state: ' + authResult['error']);
        }
    }

    function Signoutplus() {
        gapi.auth.signOut();
        $('#fb-logout').attr('data-social', '');
        $('#registration-form #id_firstname').val('');
        $('#registration-form #id_lastname').val('');
        $('#registration-form #id_dob').val('');
        $('#registration-form #id_email').val('');
        $('.connect-with').show('fast', function() {});
        $('#fb-logout-div').hide('fast', function() {});
    }
    $(document).on('click', '#fb-logout', function(event) {
        //event.preventDefault();
        var social = $('#fb-logout').data('social');
        if(social == 'facebook') {
            fbLogout();
        }
        if(social == 'googleplus') {
            Signoutplus();
        };

    });
</script>

{% endblock %}
